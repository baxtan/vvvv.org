{{- /* Last Month in Review */ -}}

{{- $pages := slice -}}
{{- $pages = (where .Site.RegularPages "Params.categories" "Monthly Reviews").ByDate.Reverse -}}
{{- $lastMonthInReview := index $pages 0 -}}

{{- $blogDates := where .Site.RegularPages "Params.categories" "Dates" -}}

{{- /* Future Dates */ -}}

{{- $futureDates := slice -}}
{{- range $blogDates -}}
  {{- $toDate := int (trim (default "0" .Params.where.to_date) " ") -}}
  {{- if ge $toDate (time.Now.Unix) -}}
    {{- $futureDates = $futureDates | append . -}}
  {{- end -}}
{{- end -}}
{{- $futureDates = first 3 $futureDates.ByDate.Reverse -}}  

{{- /* Past Dates */ -}}

{{- $pastDates := slice -}}
{{- range $blogDates -}}
  {{- $toDate := int (trim (default "0" .Params.where.to_date) " ") -}}
  {{- if lt $toDate (time.Now.Unix) -}}
    {{- $pastDates = $pastDates | append . -}}
  {{- end -}}
{{- end -}}
{{- $pastDates = first 3 $pastDates.ByDate.Reverse -}}  

{{- $siteRes := .Resources -}}

<rss version="2.0"
xmlns:vvvv="https://vvvv.org/rss"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/elements/1.1/" 
xmlns:atom="http://www.w3.org/2005/Atom"
xmlns:media="http://search.yahoo.com/mrss/">

  <channel>
    <title>vvvv &#8211; Overview</title>
    <link>{{ .Permalink }}</link>
    {{- with .OutputFormats.Get "RSS" -}}
    {{ printf "<atom:link href=%q rel=\"self\" type=%q />" .Permalink .MediaType | safeHTML }}
    {{- end -}}
    <image>
			<title>vvvv &#8211; Overview</title>
			<link>{{.Site.BaseURL}}</link>
			<url>{{ "img/ogVVVV.jpg" | absURL }}</url>
		</image>
    <description>A RSS news feed for vvvv community section</description>
    <generator>Hugo -- gohugo.io</generator>
    {{ with $.Site.LanguageCode }}
    <language>{{.}}</language>
    {{end}}
    <lastBuildDate>{{ now.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</lastBuildDate>

    {{ with $lastMonthInReview}}
      <item>
        <title>{{ .Title }}</title>
        <link>{{ .Permalink }}</link>
        {{ with .Params.author }}
          <dc:creator>{{.}}</dc:creator>
        {{end}}
        <pubDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</pubDate>
        <category>{{ .Params.categories }}</category>
        {{ $thumb := resources.Get "img/grey-thumb.png"}}
          {{ $pageRes := .Resources}}
            {{ with .Params.thumb}}
              {{ with $pageRes.GetMatch .}}
                  {{ $thumb = . }}
              {{ end }}
          {{ end }}
        {{ $thumbSite := $thumb.Fill "80x80 jpg"}}
        <thumb>{{ $thumbSite.Permalink }}</thumb>
        <guid isPermaLink="false">{{ printf "%s#%s" .Permalink (.Date.Format "02-01-06") }}</guid>
        <description>{{- .Params.description | html -}}</description>
        {{ $thumbRSS := $thumb.Resize "600x jpeg"}}
        {{ $sizeInBytes := len $thumbRSS.Content }}
        <enclosure url="{{ $thumbRSS.Permalink }}" length="{{ $sizeInBytes }}" type="image/jpeg" />
        <updated>{{ .Date | safeHTML }}</updated>
      </item>
    {{ end }}

    {{- range $futureDates -}}
      {{- $data := dict
        "Item" .
        "Category" ""
      -}}
      {{- partial "community/dateitem.xml" $data -}}
    {{- end -}}

    {{- range $pastDates -}}
      {{- $data := dict
        "Item" .
        "Category" "/Past"
      -}}
      {{ partial "community/dateitem.xml" $data -}}
    {{- end -}}
  </channel>
</rss>