{{- /* Last Month in Review */ -}}

{{- $pages := slice -}}
{{- $pages = (where .Site.RegularPages "Params.categories" "Monthly Reviews").ByDate.Reverse -}}
{{- $lastMonthInReview := index $pages 0 -}}

{{- $blogDates := where .Site.RegularPages "Params.categories" "Dates" -}}

{{- /* Dates */ -}}

{{- $dates := first 3 (sort $blogDates "Date" "desc") -}}  

{{- /* Future Dates */ -}}

{{- $futureDates := slice -}}
{{- range $blogDates -}}
  {{- $toDate := int (trim (default "0" .Params.where.to_date) " ") -}}
  {{- if ge $toDate (time.Now.Unix) -}}
    {{- $futureDates = $futureDates | append . -}}
  {{- end -}}
{{- end -}}
{{- $futureDates = first 3 (sort $futureDates "Date" "desc") -}}

{{- /* Past Dates */ -}}

{{- $pastDates := slice -}}
{{- range $blogDates -}}
  {{- $toDate := int (trim (default "0" .Params.where.to_date) " ") -}}
  {{- if lt $toDate (time.Now.Unix) -}}
    {{- $pastDates = $pastDates | append . -}}
  {{- end -}}
{{- end -}}
{{- $pastDates = first 3 (sort $pastDates "Date" "desc") -}}

{{- $siteRes := .Resources -}}

{
  {{- with $lastMonthInReview -}}
    {{- $thumb := resources.Get "img/grey-thumb.png" -}}
          {{- $pageRes := .Resources -}}
            {{- with .Params.thumb -}}
              {{- with $pageRes.GetMatch . -}}
                  {{- $thumb = . -}}
              {{- end -}}
          {{- end -}}
    {{- $thumbSite := $thumb.Fill "80x80 jpg" -}}
    "lastMonthInReview": {
      "title": {{- .Title | jsonify -}},
      "link": "{{- .Permalink -}}",
      "thumb": "{{- $thumbSite.Permalink -}}",
      "description": {{- .Params.description | jsonify -}},
      "pubDate": {{- .Date.Unix -}}
    },
  {{- end -}}

  "dates":[
    {{ partial "community/dateitems.json" $dates }}
  ],

  "futureDates":[
    {{ partial "community/dateitems.json" $futureDates }}
  ],

  "pastDates":[
    {{ partial "community/dateitems.json" $pastDates }}
  ]
}