import{a4 as o,bf as f}from"./app.js";import{l as h}from"./app-LinksHelper-CnJVBijP.js";const m={user:{url:`${o.GET_USERS}?fields=username,related.social.{SOCIAL}&filter[related][social][{SOCIAL}][_nempty]=true&sort=username`,itemPath:"related.social"},company:{url:`${o.GET_COMPANIES}?fields=name,slug,social.{SOCIAL}&filter[social][{SOCIAL}][_nempty]=true&sort=name`,itemPath:"social"},edu:{url:`${o.GET_EDUS}?fields=name,slug,social.{SOCIAL}&filter[social][{SOCIAL}][_nempty]=true&sort=name`,itemPath:"social"}};async function d(t,e){const n=m[t],s=n?.url.replaceAll("{SOCIAL}",e);if(!s)throw new Error("Can't fetch Social");const c=await fetch(s);if(c.ok){const r=await c.json();return{items:r.data.map(i=>{const u=h(e,i[n.itemPath][e]);return{name:i.username||i.name,label:u.text,connectionLink:u.url,slug:i.slug}}),total:r.meta?.filter_count??0}}else throw Error("Connection Error")}const y=o.BASEURL+"items/Company?fields=*&sort=name&meta=filter_count",S="withoutEnlargement=true&fit=inside&height=120&quality=90&format=png",p=f("businessList",{state:()=>({list:{},selectedSection:a[0],selectedConnection:l[0],sections:a,socialOptions:l,loading:!1}),actions:{async setSection(t){this.selectedSection=a.find(e=>e.key==t),t=="list"&&this.getList(!0),t=="connections"&&this.setConnection(l[0].key)},async setConnection(t){this.selectedConnection=l.find(e=>e.key==t),this.getConnection(!0)},async getList(t=!1){if(!(this.list.list&&!t)){this.loading=!0;try{this.list.list=await C()}catch{this.fetched=!1}finally{this.loading=!1}}},async getConnection(t=!1){if(!(this.list.connections&&!t)){this.loading=!0;try{const e=await d("company",this.selectedConnection.key);e.items.forEach(n=>{n.profileLink="/business/"+n.slug,n.key="business"}),this.list.connections=e}catch(e){console.log(e)}finally{this.loading=!1}}}}}),a=[{label:"List",key:"list",content:"List"},{label:"Connections",key:"connections",content:"Social"}],l=[{label:"GitHub",key:"github"},{label:"NuGet",key:"nuget"},{label:"Mastodon",key:"mastodon"},{label:"Pixelfed",key:"pixelfed"},{label:"LinkedIn",key:"linkedin"},{label:"YouTube",key:"youtube"},{label:"PeerTube",key:"peertube"}];function g(t){return t?`${o.ASSETS}${t}?${S}`:null}async function C(){const t=await fetch(y);if(t.ok){const e=await t.json(),n=e.data;return n.forEach(s=>{s.logo=g(s.logo)}),{items:n,total:e.meta?.filter_count??0}}else throw Error("Connection Error")}export{p as u};
